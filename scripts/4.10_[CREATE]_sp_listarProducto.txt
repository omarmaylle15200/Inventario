DELIMITER //
create PROCEDURE sp_listarProducto(in v_idCategoria int,
                                  in v_codigoReferencia varchar(20),
                                  in v_modelo varchar(50),
                                  in v_nombre varchar(50),
                                  in v_fechaInicio date,
                                  in v_fechaFin date)
BEGIN
	
    select 
    	p.IdProducto,
        ifnull(p.CodigoReferencia,'') CodigoReferencia,
        ifnull(p.Modelo,'') Modelo,
        ifnull(p.Nombre,'') Nombre,
        ifnull(p.Descripcion,'') Descripcion,
        ifnull(p.PrecioCompra,0.0) PrecioCompra,
        ifnull(p.PrecioVenta,0.0) PrecioVenta,
        ifnull(p.Cantidad,0) Cantidad,
        ifnull(p.IdCategoria,0) IdCategoria,
        ifnull(c.Nombre,'') NombreCategoria,
        ifnull(p.IdProveedor,0) IdProveedor,
        ifnull(pv.Nombre,'') NombreProveedor,
        ifnull(p.EsActivo,0) EsActivo,
        ifnull(p.IdUsuarioRegistro,0) IdUsuarioRegistro,
        ifnull(p.IdUsuarioModificacion,0) IdUsuarioModificacion,
        p.FechaRegistro,
        p.FechaModificacion
    from producto p 
    INNER join categoria c on p.IdCategoria=c.IdCategoria
    INNER join proveedor pv on pv.IdProveedor=p.IdProveedor
    where 
    p.IdCategoria=if(v_idCategoria=0,p.IdCategoria,v_idCategoria)
    #and  p.CodigoReferencia=if(ifnull(v_codigoReferencia,'')='',p.CodigoReferencia,v_codigoReferencia)
    #and  p.Modelo=if(ifnull(v_modelo,'')='',p.Modelo,v_modelo)
    and  p.Nombre=if(ifnull(v_nombre,'')='',p.Nombre,v_nombre)
    and CONVERT(p.FechaRegistro, DATE) BETWEEN v_fechaInicio and v_fechaFin;
    
END //